# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ master ] # Assuming 'master' is your primary branch
  pull_request:
    branches: [ master ] # Assuming 'master' is your primary branch

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Haskell and Stack
      uses: haskell-actions/setup@v2
      with:
        ghc-version: 'recommended' # Or pin to a specific version if needed
        stack-version: 'recommended' # Or pin to a specific version

    - name: Cache Stack dependencies
      uses: actions/cache@v4
      with:
        path: |
          ~/.stack
          .stack-work
        key: ${{ runner.os }}-stack-${{ hashFiles('stack.yaml') }}-${{ hashFiles('blog.cabal') }}
        restore-keys: |
          ${{ runner.os }}-stack-

    - name: Install dependencies
      run: stack build --only-dependencies

    - name: Build project
      run: stack build

    - name: Generate blog content
      run: stack run blog -- rebuild # This is the command from the Makefile's 'generate' target

    # Optional: Add a step here to deploy to GitHub Pages or another hosting service
    # - name: Deploy to GitHub Pages
    #   if: github.event_name == 'push' && github.ref == 'refs/heads/master'
    #   uses: peaceiris/actions-gh-pages@v3
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}
    #     publish_dir: ./docs 
    #     # cname: your.custom.domain.com # Uncomment if you have a custom domain
